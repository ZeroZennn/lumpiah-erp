#!/usr/bin/env sh

echo "ğŸ” Running pre-push checks..."
echo ""

# Build API Server (NestJS)
echo "ğŸ“¦ Building API Server..."
cd apps/api-server
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ API Server build failed!"
  exit 1
fi
echo "âœ… API Server build successful!"
echo ""

# Build Web Admin (Next.js)
echo "ğŸ“¦ Building Web Admin..."
cd ../lumpiah-web-admin
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Web Admin build failed!"
  exit 1
fi
echo "âœ… Web Admin build successful!"
echo ""

# Flutter analyze (optional - just checks for errors, doesn't build APK)
echo "ğŸ“± Analyzing Flutter project..."
cd ../mobile_pos_cashier
flutter analyze --no-fatal-infos --no-fatal-warnings
if [ $? -ne 0 ]; then
  echo "âŒ Flutter analysis found errors!"
  exit 1
fi
echo "âœ… Flutter analysis passed!"
echo ""

echo "ğŸ‰ All pre-push checks passed! Pushing..."
